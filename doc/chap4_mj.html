<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
         "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<title>GAP (ProgressBar) - Chapter 4: Progress Printer</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="generator" content="GAPDoc2HTML" />
<link rel="stylesheet" type="text/css" href="manual.css" />
<script src="manual.js" type="text/javascript"></script>
<script type="text/javascript">overwriteStyle();</script>
</head>
<body class="chap4"  onload="jscontent()">
<link rel="stylesheet" type="text/css" href="style/style.css" />


<div class="chlinktop"><span class="chlink1">Goto Chapter: </span><a href="chap0_mj.html">Top</a>  <a href="chap1_mj.html">1</a>  <a href="chap2_mj.html">2</a>  <a href="chap3_mj.html">3</a>  <a href="chap4_mj.html">4</a>  <a href="chap5_mj.html">5</a>  <a href="chapInd_mj.html">Ind</a>  </div>

<div class="chlinkprevnexttop">&nbsp;<a href="chap0_mj.html">[Top of Book]</a>&nbsp;  <a href="chap0_mj.html#contents">[Contents]</a>&nbsp;  &nbsp;<a href="chap3_mj.html">[Previous Chapter]</a>&nbsp;  &nbsp;<a href="chap5_mj.html">[Next Chapter]</a>&nbsp;  </div>

<p id="mathjaxlink" class="pcenter"><a href="chap4.html">[MathJax off]</a></p>
<p><a id="X86AB6DB07A391A1F" name="X86AB6DB07A391A1F"></a></p>
<div class="ChapSects"><a href="chap4_mj.html#X86AB6DB07A391A1F">4 <span class="Heading">Progress Printer</span></a>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X850221DD867F9E76">4.1 <span class="Heading">Terminal</span></a>
</span>
</div>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X8396BA6D7925C709">4.2 <span class="Heading">Block</span></a>
</span>
</div>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X79531D707FC164B2">4.3 <span class="Heading">Pattern</span></a>
</span>
<div class="ContSSBlock">
<span class="ContSS"><br /><span class="nocss">&nbsp;&nbsp;</span><a href="chap4_mj.html#X85482839827D3458">4.3-1 <span class="Heading">Creating Blocks</span></a>
</span>
</div></div>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X7BB31676791CF4E5">4.4 <span class="Heading">Layout</span></a>
</span>
</div>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X8630A6D77DBE6FC7">4.5 <span class="Heading">Printer Module</span></a>
</span>
<div class="ContSSBlock">
<span class="ContSS"><br /><span class="nocss">&nbsp;&nbsp;</span><a href="chap4_mj.html#X814E7CE2792896ED">4.5-1 dimensions</a></span>
<span class="ContSS"><br /><span class="nocss">&nbsp;&nbsp;</span><a href="chap4_mj.html#X8245F6B27FF00684">4.5-2 generate</a></span>
<span class="ContSS"><br /><span class="nocss">&nbsp;&nbsp;</span><a href="chap4_mj.html#X8192E39F7A7B67A1">4.5-3 update</a></span>
</div></div>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X78289A737AF28B39">4.6 <span class="Heading">Implementation</span></a>
</span>
</div>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X7B09033178D1107A">4.7 <span class="Heading">Process</span></a>
</span>
</div>
<div class="ContSect"><span class="tocline"><span class="nocss">&nbsp;</span><a href="chap4_mj.html#X85861B017AEEC50B">4.8 <span class="Heading">Example</span></a>
</span>
</div>
</div>

<h3>4 <span class="Heading">Progress Printer</span></h3>

<p>Here we include a guide how to modify the progress printing. This chapter is intended for <em>advanced users</em> or <em>developers</em> of the package.</p>

<p>The <em>progress printer</em> is a framework built from a collection of <em>printer moduls</em> that are solely responsible to display a specific information about the current state of a process e.g. the number of completed iterations or the total runtime. Moreover it specifies an abstract <em>layout</em> e.g. the positional relations between the individual moduls.</p>

<p>In the following we explain the terminology of the framework and the technical implementation. See also Section <a href="chap2_mj.html#X8578A2598059B94F"><span class="RefLink">2.1</span></a> for some basic terminology.</p>

<p>In the end we include an example how to adjust the progress printer.</p>

<p><a id="X850221DD867F9E76" name="X850221DD867F9E76"></a></p>

<h4>4.1 <span class="Heading">Terminal</span></h4>

<p>We can think of the <em>terminal</em> as a finite grid of cells each indexed by an <code class="code">(x, y)</code>-coordinate and assigned a single character. The <em>cursor</em> is an object that occupies the space of exactly one cell. We are able to perform the following actions:</p>


<ul>
<li><p>move the cursor to an adjacent cell</p>

</li>
<li><p>overwrite the character of the cell occupied by the cursor</p>

</li>
</ul>
<p>The coordinate <code class="code">(1, 1)</code> denotes the cell in the terminal where the usual <code class="code">Print</code> command would start to write a character, i.e. the initial position of the cursor after hitting the "enter key" on the gap prompt. We think of this cell as the top left corner of the space that we reserve to print the progress. Increasing the <code class="code">x</code>-coordinate can be understood as movement to the right, whereas increasing the <code class="code">y</code>-coordinate as movement to the bottom.</p>

<p><a id="X8396BA6D7925C709" name="X8396BA6D7925C709"></a></p>

<h4>4.2 <span class="Heading">Block</span></h4>

<p>A <em>block</em> is a virtually allocated space in the terminal (see Section <a href="chap4_mj.html#X850221DD867F9E76"><span class="RefLink">4.1</span></a>) in form of a rectangle, a record <code class="code">rec(x, y, w, h)</code>, where the top left corner of the interior is the cell at the coordinate <code class="code">(x, y)</code>, the width is given by <code class="code">w</code> and the height by <code class="code">h</code>, i.e. the bottom right corner of the interior is the cell at the coordinate <code class="code">(x + w - 1, y + h - 1)</code>.</p>

<p>For example we would see something akin to the following if we fill the inside of the block <code class="code">(x := 3, y := 2, w := 5, h := 2)</code> with the symbols "<code class="keyw">O</code>" and use a simple dot "<code class="keyw">.</code>" for the outside:</p>


<div class="example"><pre>
..........
..OOOOO...
..OOOOO...
..........
..........
</pre></div>

<p><a id="X79531D707FC164B2" name="X79531D707FC164B2"></a></p>

<h4>4.3 <span class="Heading">Pattern</span></h4>

<p>The main purpose of a <em>pattern</em> is to encode a coherent display of the progress. We use patterns to create blocks in a structured and uniform manner of which a few special ones are defining bounds for printer modules. The progress printer has a <em>pattern tree</em> whose nodes are patterns, records that contain the following entries:</p>


<dl>
<dt><strong class="Mark">id</strong></dt>
<dd><p>Unique identifier string of the pattern.</p>

</dd>
<dt><strong class="Mark">parent</strong></dt>
<dd><p>A pattern or <code class="code">fail</code>.</p>

</dd>
<dt><strong class="Mark">children</strong></dt>
<dd><p>List of patterns.</p>

</dd>
<dt><strong class="Mark">isActive</strong></dt>
<dd><p>A function that takes as input a process and returns whether the branch starting in this pattern is active.</p>

</dd>
<dt><strong class="Mark">alignment</strong></dt>
<dd><p><code class="keyw">"horizontal"</code> all blocks created from children of this pattern are aligned horizontally, i.e. they have equal <code class="code">y</code>-coordinates and heights.</p>

<p><code class="keyw">"vertical"</code> all blocks created from children of this pattern are aligned vertically, i.e. they have equal <code class="code">x</code>-coordinates and widths.</p>

</dd>
<dt><strong class="Mark">sync</strong></dt>
<dd><p><code class="keyw">["dim", ...]</code> all blocks created from this pattern have equal values for the dimension <var class="Arg">dim</var>, etc.</p>

</dd>
</dl>
<p>If a pattern is a leaf node, it must additionally contain the following entries:</p>


<dl>
<dt><strong class="Mark">printer</strong></dt>
<dd><p>A printer module.</p>

</dd>
<dt><strong class="Mark">printer_options</strong></dt>
<dd><p>An options record for the printer.</p>

</dd>
</dl>
<p><a id="X85482839827D3458" name="X85482839827D3458"></a></p>

<h5>4.3-1 <span class="Heading">Creating Blocks</span></h5>

<p>For each process we create blocks from the pattern tree using a recursive strategy: If the pattern is active for the given process (<code class="code">pattern.isActive(process) = True</code>), we create a block with the given id (stored in <code class="code">process.blocks.id</code>) and apply the same strategy for all children of the pattern.</p>

<p>A block created from the root of the pattern tree is called a <em>process block</em>. The width of a process block spans the whole terminal screen. Furthermore we require that the process blocks are stacked from top to bottom following the natural ordering of the process tree given by DFS (depth-first search).</p>

<p>A block created from an inner node of the pattern tree is called a <em>composition block</em>. The interior of such a block must be the disjoint union of the interior of its children, and either the children are aligned horizontally within the block, or vertically. Visually speaking, we split a composition block into smaller blocks by either using only vertical or horizontal cuts.</p>

<p>A block created from a leaf node of the pattern tree is called a <em>printer block</em>. This block corresponds to a printer module that is capable of displaying a specific information about the current state of a process inside the block bounds. (See <a href="chap4_mj.html#X8630A6D77DBE6FC7"><span class="RefLink">4.5</span></a>)</p>

<p><a id="X7BB31676791CF4E5" name="X7BB31676791CF4E5"></a></p>

<h4>4.4 <span class="Heading">Layout</span></h4>

<p>The <em>layout</em> is a record containing the following entries:</p>


<dl>
<dt><strong class="Mark">Setup</strong></dt>
<dd><p>A function that setups the following entries of the progress printer using the current options in <code class="code">ProgressPrinter.Options</code>:</p>


<ul>
<li><p><code class="code">ProgressPrinter.Pattern</code></p>

</li>
<li><p><code class="code">ProgressPrinter.InitialConfiguration</code></p>

</li>
</ul>
</dd>
<dt><strong class="Mark">DefaultOptions</strong></dt>
<dd><p>The default options record for <code class="code">Setup</code>.</p>

</dd>
</dl>
<p><a id="X8630A6D77DBE6FC7" name="X8630A6D77DBE6FC7"></a></p>

<h4>4.5 <span class="Heading">Printer Module</span></h4>

<p>A <em>printer module</em> is responsible for displaying a specific information about the current state of a process e.g. the number of completed iterations or the total runtime. Technically, it is a record that must contain the following functions as entries where the argument <var class="Arg">options</var> must be valid printer options for this module. For a description of all available printer modules, see Chapter <a href="chap5_mj.html#X7996A5BD86CD41BD"><span class="RefLink">5</span></a>.</p>

<p><a id="X814E7CE2792896ED" name="X814E7CE2792896ED"></a></p>

<h5>4.5-1 dimensions</h5>

<div class="func"><table class="func" width="100%"><tr><td class="tdleft"><code class="func">&#8227; dimensions</code>( <var class="Arg">process</var>, <var class="Arg">options</var> )</td><td class="tdright">(&nbsp;function&nbsp;)</td></tr></table></div>
<p>Returns a dimensions record <code class="code">rec(w, h)</code> where the dimensions are positive integers or <code class="code">fail</code>.</p>

<p>If the values are integers, they specify the smallest dimensions of a block that is capable to display the information about the current state of this process.</p>

<p>A value <code class="code">fail</code> indicates that the dimension is unspecified and can be replaced by any arbitrary positive integer.</p>

<p><a id="X8245F6B27FF00684" name="X8245F6B27FF00684"></a></p>

<h5>4.5-2 generate</h5>

<div class="func"><table class="func" width="100%"><tr><td class="tdleft"><code class="func">&#8227; generate</code>( <var class="Arg">process</var>, <var class="Arg">id</var>, <var class="Arg">options</var> )</td><td class="tdright">(&nbsp;function&nbsp;)</td></tr></table></div>
<p>Displays the information of this process in the block with identifier <var class="Arg">id</var> under the assumption that the block contains no characters and is large enough to display the information.</p>

<p>Therefore the printer usually needs to write characters for most of the interior of the block.</p>

<p><a id="X8192E39F7A7B67A1" name="X8192E39F7A7B67A1"></a></p>

<h5>4.5-3 update</h5>

<div class="func"><table class="func" width="100%"><tr><td class="tdleft"><code class="func">&#8227; update</code>( <var class="Arg">process</var>, <var class="Arg">id</var>, <var class="Arg">options</var> )</td><td class="tdright">(&nbsp;function&nbsp;)</td></tr></table></div>
<p>Displays the information of this process in the block with identifier <var class="Arg">id</var> under the assumption that <code class="code">generate</code> was called beforehand and the block bounds haven't changed since then.</p>

<p>Therefore the printer usually just updates a few characters in the terminal.</p>

<p>Returns <code class="code">true</code> if it is capable to display the information in the block, otherwise <code class="code">false</code>.</p>

<p><a id="X78289A737AF28B39" name="X78289A737AF28B39"></a></p>

<h4>4.6 <span class="Heading">Implementation</span></h4>

<p>The <em>progress printer</em>, as described in the introduction of this chapter, is implemented as a record that eventually contains the following entries:</p>


<dl>
<dt><strong class="Mark">Layout</strong></dt>
<dd><p>A record <code class="code">rec(Setup, DefaultOptions)</code> for setting up a layout.</p>

</dd>
<dt><strong class="Mark">RootProcess</strong></dt>
<dd><p>The process tree containing the main process as the root.</p>

</dd>
<dt><strong class="Mark">Dimensions</strong></dt>
<dd><p>A record <code class="code">rec(w, h)</code> encoding the virtual bounds in the terminal.</p>

</dd>
<dt><strong class="Mark">Cursor</strong></dt>
<dd><p>A record <code class="code">rec(x, y)</code> encoding the cursor position.</p>

</dd>
<dt><strong class="Mark">TimeStamp</strong></dt>
<dd><p>An internal time stamp that is changed whenever a process is refreshed.</p>

</dd>
<dt><strong class="Mark">Options</strong></dt>
<dd><p>The current options record for <code class="code">Layout.Setup</code>.</p>

</dd>
<dt><strong class="Mark">Pattern</strong></dt>
<dd><p>The tree consisting of patterns.</p>

</dd>
<dt><strong class="Mark">InitialConfiguration</strong></dt>
<dd><p>A configuration is a list containing entries describing linear equations. These describe additional relations between the blocks created from the patterns of the layout.</p>

<p>An entry is of the form <code class="code">[ factor, rec(id, param), ..., a ]</code> which is interpreted as <code class="code">factor * id.param + ... = a</code>. Here, <code class="code">factor</code> and <code class="code">a</code> must be integers, <code class="code">id</code> the identifier of a pattern in the layout and <code class="code">param</code> a parameter of a block, i.e. either <code class="code">"x"</code>, <code class="code">"y"</code>, <code class="code">"w"</code> or <code class="code">"h"</code>.</p>

</dd>
<dt><strong class="Mark">CurProcess</strong></dt>
<dd><p>The process that is currently running.</p>

</dd>
</dl>
<p><a id="X7B09033178D1107A" name="X7B09033178D1107A"></a></p>

<h4>4.7 <span class="Heading">Process</span></h4>

<p>See Section <a href="chap2_mj.html#X8578A2598059B94F"><span class="RefLink">2.1</span></a> for the basic terminology. An abstract <em>process</em> is encoded via a <em>process record</em>, but we usually omit the distinction between them. The record has the following entries:</p>


<dl>
<dt><strong class="Mark">id</strong></dt>
<dd><p>Unique identifier string of the process.</p>

</dd>
<dt><strong class="Mark">parent</strong></dt>
<dd><p>A process record or <code class="code">fail</code>.</p>

</dd>
<dt><strong class="Mark">children</strong></dt>
<dd><p>List of process records.</p>

</dd>
<dt><strong class="Mark">depth</strong></dt>
<dd><p>The depth is a non-negative integer showing how far nested this process is in the root. The root has <code class="code">depth = 0</code>. Any other process has <code class="code">depth = parent.depth + 1</code>.</p>

</dd>
<dt><strong class="Mark">totalTime</strong></dt>
<dd><p>Total runtime of process up to the most recent refresh.</p>

</dd>
<dt><strong class="Mark">status</strong></dt>
<dd><p>The main intent is to mark for the <code class="code">RefreshProcess</code> command how to update the total runtime of a process.</p>

<p>A <em>permanent</em> status is one that can last after a refresh:</p>

<p><code class="keyw">"active"</code>, <code class="keyw">"inactive"</code>, <code class="keyw">"complete"</code>.</p>

<p>A <em>temporary</em> status is one that transforms immediately into a new one after a refresh:</p>

<p><code class="keyw">"started"</code>, <code class="keyw">"stopped"</code>, <code class="keyw">"terminated"</code>.</p>

<p>Below is a flow chart showcasing how each status can be transformed into one another, given that <var class="Arg">doRefresh</var> is true. Therefore we only deal with the commands <code class="code">StartProcess</code>, <code class="code">StopProcess</code> and <code class="code">TerminateProcess</code> for a permanent status. We ommit the arrows for those commands that do not change the status.</p>


<pre class="normal">


           +----------+
+--------&gt; |          |      Refresh
|          | inactive | &lt;--------------+
+----------+          |                |
  Refresh  +----+-----+                |
                |                      |
                | Start                |
                |                      |
                v                      |
           +----------+                |
           |          |                |
           | started  |                |
           |          |                |
           +----+-----+                |
                |                      |
                | Refresh              |
                |                      |
                v                      |
           +----------+          +-----+----+
+--------&gt; |          |  Stop    |          |
|          |  active  +--------&gt; | stopped  |
+----------+          |          |          |
  Refresh  +----+-----+          +----------+
                |
                | Terminate
                |
                v
           +----------+
           |          |
           |terminated|
           |          |
           +----+-----+
                |
                | Refresh
                |
                v
           +----------+
+--------&gt; |          |
|          | complete |
+----------+          |
  Refresh  +----------+


</pre>

<p>We mention one edge case for completeness. If a process is defined via an iterator that doesn't complete after <code class="code">totalSteps</code>, we change back from the <code class="code">complete</code> status to the <code class="code">active</code> status, and set <code class="code">totalSteps := infinity</code> and <code class="code">blocks := rec()</code>.</p>

</dd>
<dt><strong class="Mark">completedSteps</strong></dt>
<dd><p>The number of completed steps of a process. It is initialized with -1. This indicates that the process hasn't started yet.</p>

</dd>
<dt><strong class="Mark">totalSteps</strong></dt>
<dd><p>Number of comleted steps for a process to be marked as terminated.</p>

</dd>
<dt><strong class="Mark">content</strong></dt>
<dd><p>Extra content of the process that may be used by the progress printer or printer modules.</p>

</dd>
<dt><strong class="Mark">blocks</strong></dt>
<dd><p>A record containing entries <code class="code">id := block</code>, where <code class="code">id</code> is a string corresponding to an id in the used pattern, and a <code class="code">block</code> is a record of the form <code class="code">rec(x, y, w, h)</code>. A printer block may be popullated with additional entries by the corresponding printer module.</p>

</dd>
</dl>
<p><a id="X85861B017AEEC50B" name="X85861B017AEEC50B"></a></p>

<h4>4.8 <span class="Heading">Example</span></h4>

<p>TODO</p>


<div class="chlinkprevnextbot">&nbsp;<a href="chap0_mj.html">[Top of Book]</a>&nbsp;  <a href="chap0_mj.html#contents">[Contents]</a>&nbsp;  &nbsp;<a href="chap3_mj.html">[Previous Chapter]</a>&nbsp;  &nbsp;<a href="chap5_mj.html">[Next Chapter]</a>&nbsp;  </div>


<div class="chlinkbot"><span class="chlink1">Goto Chapter: </span><a href="chap0_mj.html">Top</a>  <a href="chap1_mj.html">1</a>  <a href="chap2_mj.html">2</a>  <a href="chap3_mj.html">3</a>  <a href="chap4_mj.html">4</a>  <a href="chap5_mj.html">5</a>  <a href="chapInd_mj.html">Ind</a>  </div>

<hr />
<p class="foot">generated by <a href="http://www.math.rwth-aachen.de/~Frank.Luebeck/GAPDoc">GAPDoc2HTML</a></p>
</body>
</html>
